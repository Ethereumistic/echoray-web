# EchoRay.io SaaS Dashboard Sidebar - UX Refactoring Plan

## Executive Summary

This plan addresses the fundamental UX confusion caused by mixing personal (`/p/`) and organizational (`/o/`) scopes in a single sidebar navigation structure. The current implementation creates cognitive load by blending two distinct workspaces, making it unclear which context the user is operating in.
Most importantly is to keep all the functionalities of the current platform, and not break anything while refactoring.

---

## Current Problems Analysis

### 1. **Scope Confusion**
- Users can't easily tell if they're in personal or organizational context
- Navigation items switch behavior based on hidden state (activeOrganization)
- "Projects" dropdown mixes personal and org items under one label
- Routes like `/dashboard` redirect to `/p/[userId]` creating unnecessary indirection

### 2. **Inconsistent Mental Model**
- "Overview" â†’ redirects through `/dashboard` to `/p/[userId]`
- "Workspace" â†’ only appears when org is selected
- "Projects" â†’ shows both personal and org projects in subitems
- "Team" â†’ routes to different places based on context
- "Settings" â†’ label changes between "Workspace Settings" and "Settings"

### 3. **Footer Dropdown Duplication**
- "Workspace Settings" appears in both sidebar body AND dropdown header
- Context switching happens in footer dropdown, but nav items don't clearly reflect context
- Organizations list in dropdown, but no clear "Personal Workspace" option

### 4. **Subscription Tier Display Issues**
- Header subscription tier doesn't route anywhere (should route to `/`)
- No clear indication of what features are available in current scope

---

## Proposed Solution: Context-Aware Sidebar Architecture

### Core Principle
**One Context, One Sidebar** - The sidebar should clearly represent either Personal or Organizational workspace, never both simultaneously.

---

## New Sidebar Structure

### HEADER SECTION

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Logo] EchoRay                      â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ¢ ACME Corp        [â–¼]         â”‚ â”‚  â† Context Switcher
â”‚ â”‚ Professional Plan               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Implementation:**
- Logo + Logotype (clickable, routes to `/`)
- **Context Switcher Button** (replaces subscription tier display)
  - Shows current context: Organization name + tier OR "Personal â€¢ [Tier]"
  - Clicking opens context switcher popover/dropdown
  - Visual distinction: org icon vs. user icon

**Context Switcher Dropdown:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WORKSPACES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ ğŸ¢ ACME Corp (Professional)      â”‚ â† Active org
â”‚   ğŸ¢ DevTeam (Team)                 â”‚ â† Other orgs
â”‚   ğŸ¢ Startup Inc (Free)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ‘¤ Personal Workspace (Pro)         â”‚ â† Personal context
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â• Create Organization              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### BODY SECTION - Personal Context (`/p/`)

When in Personal Workspace:

```
ğŸ“Š Overview                    â†’ /p/[userId]
ğŸ”§ Tools & Apps               â†’ Collapsible
   ğŸ“ Notes                   â†’ /p/[userId]/notes
   ğŸ“… Calendar                â†’ /p/[userId]/calendar
   ğŸ“Š Analytics               â†’ /p/[userId]/analytics
   [Based on subscription tier]
ğŸ“„ Documents                  â†’ /p/[userId]/documents
âš™ï¸  Settings                  â†’ /p/settings
```

**Key Changes:**
- **Remove** "Workspace" (only for orgs)
- **Remove** "Projects" nomenclature (confusing with org projects)
- **Rename** to "Tools & Apps" - clear that these are features/capabilities
- **Remove** "Team" (no team in personal workspace)
- Each tool/app is tier-gated (free users see locked items with upgrade prompts)

---

### BODY SECTION - Organization Context (`/o/[orgId]`)

When in Organization Workspace:

```
ğŸ“Š Overview                    â†’ /o/[orgId]
ğŸ“ Projects                   â†’ /o/[orgId]/projects
ğŸ”§ Apps & Tools               â†’ Collapsible
   ğŸ“Š CRM                     â†’ /o/[orgId]/crm
   ğŸ“ˆ Analytics               â†’ /o/[orgId]/analytics
   ğŸ’¬ Chat                    â†’ /o/[orgId]/chat
   [Based on org's subscription tier]
ğŸ“„ Documents                  â†’ /o/[orgId]/documents
ğŸ‘¥ Team                       â†’ /o/[orgId]/team
âš™ï¸  Workspace Settings        â†’ /o/[orgId]/settings
```

**Key Changes:**
- **Add** "Projects" (makes sense in org context - team projects)
- **Add** "Apps & Tools" - org-level features based on org tier
- **Keep** "Team" (manage org members)
- Apps shown are based on the ORGANIZATION'S subscription, not user's personal tier

---

### FOOTER SECTION

**Simplified User Menu:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Avatar] John Doe                   â”‚
â”‚          john@example.com      [â–¼] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Dropdown Menu:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Avatar] John Doe                   â”‚
â”‚          john@example.com           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”” Notifications                    â”‚
â”‚ ğŸ’³ Billing & Subscription           â”‚
â”‚ âš™ï¸  Personal Settings               â”‚
â”‚ ğŸŒ“ Appearance                       â”‚
â”‚ â“ Help & Support                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸšª Sign Out                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Changes:**
- **Remove** workspace switching (moved to header)
- **Remove** "Workspace Settings" (only in org sidebar body)
- **Consolidate** Billing + Subscription into one item â†’ `/p/billing` (shows both)
- **Rename** "Settings" â†’ "Personal Settings" (clarity)
- **Remove** redundant organization display (context is in header)

---

## Routing Architecture

### Clean Route Structure

| Navigation Item | Personal Route | Org Route |
|----------------|----------------|-----------|
| **Overview** | `/p/[userId]` | `/o/[orgId]` |
| **Tools/Apps** | `/p/[userId]/[appName]` | `/o/[orgId]/[appName]` |
| **Projects** | N/A (or `/p/[userId]/projects` if needed) | `/o/[orgId]/projects` |
| **Documents** | `/p/[userId]/documents` | `/o/[orgId]/documents` |
| **Team** | N/A | `/o/[orgId]/team` |
| **Settings** | `/p/settings` | `/o/[orgId]/settings` |

### Remove These Routes
- âŒ `/dashboard` - confusing intermediate
- âŒ `/dashboard/projects` - use scope-specific routes
- âŒ `/dashboard/documents` - use scope-specific routes
- âŒ `/dashboard/team` - doesn't make sense for personal
- âŒ `/dashboard/notifications` - use `/p/notifications`
- âŒ `/dashboard/billing` - use `/p/billing`
- âŒ `/dashboard/subscription` - consolidate into `/p/billing`

---

## Implementation Steps

### Phase 1: Data & State Management

**File: `app-sidebar.tsx`**

1. **Add Context State**
   ```typescript
   type WorkspaceContext = 
     | { type: 'personal'; userId: string }
     | { type: 'organization'; orgId: string; orgName: string }
   
   const [currentContext, setCurrentContext] = useState<WorkspaceContext>()
   ```

2. **Refactor `getNavItems` Function**
   - Split into `getPersonalNavItems()` and `getOrgNavItems()`
   - Each returns context-specific navigation
   - Remove conditional logic within single function

3. **Create Context Switcher Component**
   ```typescript
   <ContextSwitcher
     currentContext={currentContext}
     organizations={organizations}
     userProfile={profile}
     onContextChange={handleContextChange}
   />
   ```

### Phase 2: Header Refactoring

**File: `app-sidebar.tsx` - Lines 166-232**

1. **Replace Subscription Tier Display** with Context Switcher
   ```tsx
   <SidebarHeader>
     <SidebarMenu>
       <SidebarMenuItem>
         {/* Logo - routes to / */}
         <Link href="/">
           <SidebarMenuButton size="lg" className="gap-2">
             <Image src="/logo.svg" width={32} height={32} />
             <span className="font-semibold">EchoRay</span>
           </SidebarMenuButton>
         </Link>
       </SidebarMenuItem>
       <SidebarMenuItem>
         <ContextSwitcher {...contextProps} />
       </SidebarMenuItem>
     </SidebarMenu>
   </SidebarHeader>
   ```

2. **Implement ContextSwitcher Component**
   - Shows active context (Personal or Org name + tier)
   - Dropdown with all available contexts
   - Visual distinction (icons for personal vs org)
   - Handles routing on context switch

### Phase 3: Navigation Refactoring

**File: `app-sidebar.tsx` - Lines 233-299**

1. **Create Separate Nav Item Functions**
   ```typescript
   const getPersonalNavItems = (userId: string, tier: SubscriptionTier): NavItem[] => [
     { title: "Overview", href: `/p/${userId}`, icon: LayoutDashboard },
     {
       title: "Tools & Apps",
       icon: Wrench,
       items: getPersonalTools(tier) // Dynamic based on tier
     },
     { title: "Documents", href: `/p/${userId}/documents`, icon: FileText },
     { title: "Settings", href: `/p/settings`, icon: Settings }
   ]

   const getOrgNavItems = (orgId: string, orgTier: SubscriptionTier): NavItem[] => [
     { title: "Overview", href: `/o/${orgId}`, icon: LayoutDashboard },
     { title: "Projects", href: `/o/${orgId}/projects`, icon: FolderOpen },
     {
       title: "Apps & Tools",
       icon: Wrench,
       items: getOrgTools(orgTier) // Dynamic based on org tier
     },
     { title: "Documents", href: `/o/${orgId}/documents`, icon: FileText },
     { title: "Team", href: `/o/${orgId}/team`, icon: Users },
     { title: "Workspace Settings", href: `/o/${orgId}/settings`, icon: Settings }
   ]
   ```

2. **Implement Tier-Based Tool Visibility**
   ```typescript
   const getPersonalTools = (tier: SubscriptionTier): SubNavItem[] => {
     const tools: SubNavItem[] = []
     
     // Free tier
     tools.push({ title: "Notes", href: `/p/${userId}/notes`, icon: FileText })
     
     if (tier === 'pro' || tier === 'enterprise') {
       tools.push({ title: "Analytics", href: `/p/${userId}/analytics`, icon: BarChart })
       tools.push({ title: "Calendar", href: `/p/${userId}/calendar`, icon: Calendar })
     }
     
     // Show locked items for upsell
     if (tier === 'free') {
       tools.push({ 
         title: "Analytics", 
         icon: BarChart, 
         locked: true,
         upgradeMessage: "Upgrade to Pro for Analytics"
       })
     }
     
     return tools
   }
   ```

3. **Render Context-Specific Navigation**
   ```tsx
   <SidebarContent>
     <SidebarGroup>
       <SidebarMenu>
         {currentContext.type === 'personal' 
           ? renderPersonalNav(currentContext.userId)
           : renderOrgNav(currentContext.orgId)
         }
       </SidebarMenu>
     </SidebarGroup>
   </SidebarContent>
   ```

### Phase 4: Footer Refactoring

**File: `app-sidebar.tsx` - Lines 300-476**

1. **Simplify Footer Dropdown**
   - Remove workspace switching (now in header)
   - Remove workspace settings (now in sidebar body for orgs)
   - Keep only user-level actions

2. **New Footer Structure**
   ```tsx
   <SidebarFooter>
     <SidebarMenu>
       <SidebarMenuItem>
         <DropdownMenu>
           <DropdownMenuTrigger asChild>
             <SidebarMenuButton size="lg">
               <Avatar>
                 <AvatarImage src={profile?.avatarUrl} />
                 <AvatarFallback>{initials}</AvatarFallback>
               </Avatar>
               <div className="grid flex-1 text-left">
                 <span className="truncate font-semibold">{profile?.displayName}</span>
                 <span className="truncate text-xs">{profile?.email}</span>
               </div>
               <ChevronsUpDown className="ml-auto" />
             </SidebarMenuButton>
           </DropdownMenuTrigger>
           <DropdownMenuContent align="end" className="w-56">
             <DropdownMenuLabel>
               <div className="flex items-center gap-2">
                 <Avatar className="h-8 w-8">
                   <AvatarImage src={profile?.avatarUrl} />
                   <AvatarFallback>{initials}</AvatarFallback>
                 </Avatar>
                 <div>
                   <div className="font-semibold">{profile?.displayName}</div>
                   <div className="text-xs text-muted-foreground">{profile?.email}</div>
                 </div>
               </div>
             </DropdownMenuLabel>
             <DropdownMenuSeparator />
             <DropdownMenuItem asChild>
               <Link href="/p/notifications">
                 <Bell className="mr-2 h-4 w-4" />
                 Notifications
               </Link>
             </DropdownMenuItem>
             <DropdownMenuItem asChild>
               <Link href="/p/billing">
                 <CreditCard className="mr-2 h-4 w-4" />
                 Billing & Subscription
               </Link>
             </DropdownMenuItem>
             <DropdownMenuItem asChild>
               <Link href="/p/settings">
                 <Settings className="mr-2 h-4 w-4" />
                 Personal Settings
               </Link>
             </DropdownMenuItem>
             <DropdownMenuItem asChild>
               <Link href="/help">
                 <HelpCircle className="mr-2 h-4 w-4" />
                 Help & Support
               </Link>
             </DropdownMenuItem>
             <DropdownMenuSeparator />
             <DropdownMenuItem onClick={handleSignOut} className="text-destructive">
               <LogOut className="mr-2 h-4 w-4" />
               Sign Out
             </DropdownMenuItem>
           </DropdownMenuContent>
         </DropdownMenu>
       </SidebarMenuItem>
     </SidebarMenu>
   </SidebarFooter>
   ```

### Phase 5: Route Cleanup & Migration

**Files to Update:**

1. **`app/dashboard/page.tsx`** â†’ Remove or redirect permanently to `/p/[userId]`
2. **`app/dashboard/projects/page.tsx`** â†’ Delete (use scoped routes)
3. **`app/dashboard/documents/page.tsx`** â†’ Delete (use scoped routes)
4. **`app/dashboard/team/page.tsx`** â†’ Delete (doesn't make sense)
5. **`app/dashboard/notifications/page.tsx`** â†’ Move to `app/p/notifications/page.tsx`
6. **`app/dashboard/billing/page.tsx`** â†’ Move to `app/p/billing/page.tsx`
7. **`app/dashboard/subscription/page.tsx`** â†’ Merge into `app/p/billing/page.tsx`

**Create New Routes:**

```
app/
â”œâ”€â”€ p/
â”‚   â””â”€â”€ [userId]/
â”‚       â”œâ”€â”€ page.tsx                    (Overview - Personal Dashboard)
â”‚       â”œâ”€â”€ notes/page.tsx
â”‚       â”œâ”€â”€ calendar/page.tsx
â”‚       â”œâ”€â”€ analytics/page.tsx
â”‚       â””â”€â”€ documents/page.tsx
â”‚   â”œâ”€â”€ settings/page.tsx
â”‚   â”œâ”€â”€ billing/page.tsx                (Combines billing + subscription)
â”‚   â””â”€â”€ notifications/page.tsx
â””â”€â”€ o/
    â””â”€â”€ [orgId]/
        â”œâ”€â”€ page.tsx                    (Overview - Org Dashboard)
        â”œâ”€â”€ projects/page.tsx
        â”œâ”€â”€ crm/page.tsx
        â”œâ”€â”€ analytics/page.tsx
        â”œâ”€â”€ chat/page.tsx
        â”œâ”€â”€ documents/page.tsx
        â”œâ”€â”€ team/page.tsx
        â””â”€â”€ settings/page.tsx
```

### Phase 6: Zustand Store Updates

**File: `stores/auth-store.ts`**

1. **Add Context State**
   ```typescript
   interface AuthState {
     profile: UserProfile | null
     organizations: Organization[]
     activeOrganization: Organization | null
     currentContext: WorkspaceContext  // NEW
     setCurrentContext: (context: WorkspaceContext) => void  // NEW
     // ... existing fields
   }
   ```

2. **Persist Context Selection**
   ```typescript
   persist(
     (set, get) => ({
       // ... existing state
       currentContext: { type: 'personal', userId: '' },
       setCurrentContext: (context) => {
         set({ currentContext: context })
         // Update activeOrganization if switching to org
         if (context.type === 'organization') {
           const org = get().organizations.find(o => o._id === context.orgId)
           set({ activeOrganization: org })
         } else {
           set({ activeOrganization: null })
         }
       },
     }),
     { name: 'auth-store' }
   )
   ```

3. **Add Helper Functions**
   ```typescript
   const useWorkspaceContext = () => {
     const context = useAuthStore(state => state.currentContext)
     const userId = useAuthStore(state => state.profile?.userId)
     
     return {
       isPersonal: context.type === 'personal',
       isOrg: context.type === 'organization',
       currentPath: context.type === 'personal' 
         ? `/p/${userId}` 
         : `/o/${context.orgId}`,
       context
     }
   }
   ```

---

## Visual UX Improvements

### 1. Context Visual Distinction

**Personal Workspace:**
- Accent color: Blue
- Icon: User/Profile icon
- Badge: Personal tier (Free/Pro/Enterprise)

**Organization Workspace:**
- Accent color: Purple/Indigo
- Icon: Building/Organization icon  
- Badge: Org tier + role (Admin/Member)

### 2. Locked Feature Indicators

For features not in current tier:

```tsx
<SidebarMenuSubButton disabled className="opacity-50">
  <Lock className="mr-2 h-4 w-4" />
  <span>Advanced Analytics</span>
  <Badge variant="outline" className="ml-auto">Pro</Badge>
</SidebarMenuSubButton>
```

Click opens upgrade modal/popover.

### 3. Active State Clarity

```tsx
<SidebarMenuButton
  asChild
  isActive={pathname === item.href}
  className={cn(
    "group relative",
    pathname === item.href && "bg-primary/10 text-primary font-medium"
  )}
>
  {/* Active indicator bar */}
  {pathname === item.href && (
    <div className="absolute left-0 top-0 h-full w-1 bg-primary rounded-r-full" />
  )}
  {/* ... */}
</SidebarMenuButton>
```

---

## Permission & Access Control

### Personal Workspace Access
```typescript
const personalTools = [
  { name: 'Notes', tier: 'free', href: `/p/${userId}/notes` },
  { name: 'Calendar', tier: 'pro', href: `/p/${userId}/calendar` },
  { name: 'Analytics', tier: 'pro', href: `/p/${userId}/analytics` },
  { name: 'AI Assistant', tier: 'enterprise', href: `/p/${userId}/ai` },
]

// Filter based on user's personal subscription tier
const availableTools = personalTools.filter(tool => 
  hasAccess(userTier, tool.tier)
)
```

### Organization Workspace Access
```typescript
const orgTools = [
  { name: 'CRM', tier: 'team', permission: 'crm.view', href: `/o/${orgId}/crm` },
  { name: 'Projects', tier: 'team', permission: 'projects.view', href: `/o/${orgId}/projects` },
  { name: 'Analytics', tier: 'professional', permission: 'analytics.view', href: `/o/${orgId}/analytics` },
]

// Filter based on:
// 1. Organization's subscription tier
// 2. User's role/permissions in the organization
const availableTools = orgTools.filter(tool => 
  hasAccess(orgTier, tool.tier) && 
  hasPermission(userRole, tool.permission)
)
```

**Key Insight:**
- A Free tier user CAN access Professional features if they're in a Professional org
- They see different tools in Personal vs Org context
- This is WHY context separation is critical

---

## Migration Guide for Users

### What Changes for Users

**Before:**
- Confusing "Projects" dropdown with mixed personal/org items
- Unclear which workspace they're in
- "Overview" redirects through `/dashboard`
- Duplicate settings options

**After:**
- Clear context indicator in header
- Clean separation of personal and org workspaces
- Direct navigation (no redirects)
- Context-specific navigation items

### User Education

**In-app Announcement:**
```
ğŸ‰ Improved Navigation!

We've made it easier to switch between your Personal 
and Organization workspaces.

âœ“ Click your workspace name in the header to switch
âœ“ Personal and Org features are now clearly separated
âœ“ Faster navigation with direct links

[Got it]
```

---

## Testing Checklist

### Context Switching Tests
- [ ] Switch from Personal to Org updates sidebar nav items
- [ ] Switch from Org to Personal updates sidebar nav items
- [ ] Context persists across page refreshes
- [ ] Context shows correct tier badge
- [ ] Switching updates URL to correct scope

### Navigation Tests
- [ ] All personal routes work (`/p/[userId]/*`)
- [ ] All org routes work (`/o/[orgId]/*`)
- [ ] No broken `/dashboard/*` redirects
- [ ] Active states highlight correctly
- [ ] Locked features show upgrade prompts

### Permission Tests
- [ ] Free user in Personal sees limited tools
- [ ] Free user in Professional Org sees org tools
- [ ] Pro user in Personal sees pro tools
- [ ] Org member sees only permitted tools
- [ ] Org admin sees all org tools

### Mobile Tests
- [ ] Context switcher works on mobile
- [ ] Collapsible nav works
- [ ] Footer dropdown positions correctly
- [ ] Touch targets are adequate

---

## Performance Considerations

1. **Lazy Load Tool Components**
   ```typescript
   const AnalyticsPage = lazy(() => import('./analytics/page'))
   ```

2. **Memoize Navigation Items**
   ```typescript
   const navItems = useMemo(
     () => currentContext.type === 'personal' 
       ? getPersonalNavItems(userId, tier)
       : getOrgNavItems(orgId, orgTier),
     [currentContext, userId, tier, orgId, orgTier]
   )
   ```

3. **Optimize Context Switching**
   - Prefetch org data on hover over org in switcher
   - Cache previous context data
   - Smooth transitions between contexts

---

## Future Enhancements

### Phase 2 Features

1. **Quick Switcher (Cmd+K)**
   - Search across all workspaces
   - Quick jump to any tool/page
   - Recently visited items

2. **Workspace Favorites**
   - Pin frequently used tools
   - Custom ordering
   - Per-workspace favorites

3. **Breadcrumb Navigation**
   - Show full path hierarchy
   - Quick navigation to parent pages
   - Works across contexts

4. **Workspace Insights**
   - Activity feed per workspace
   - Recent documents/projects
   - Team member activity (org only)

---

## Summary of Key Changes

### What Gets Removed
- âŒ `/dashboard` redirect route
- âŒ Projects dropdown mixing personal/org
- âŒ Workspace switching from footer
- âŒ Conditional navigation items
- âŒ Duplicate settings entries

### What Gets Added
- âœ… Context switcher in header
- âœ… Clear workspace indicator
- âœ… Separate personal/org nav items
- âœ… Tier-based tool visibility
- âœ… Direct routes (no redirects)

### What Gets Better
- ğŸ¯ Mental model: One workspace at a time
- ğŸ¯ Navigation: Context-specific items
- ğŸ¯ Clarity: Visual workspace distinction
- ğŸ¯ Performance: Fewer redirects
- ğŸ¯ Scalability: Easy to add new tools per scope

---

## Implementation Timeline

Phase 1-2 (State & Header)
- Set up context state management
- Build context switcher component
- Update header structure

Phase 3 (Navigation)
- Create separate nav functions
- Implement tier-based visibility
- Build locked feature indicators

Phase 4-5 (Footer & Routes)
- Simplify footer dropdown
- Migrate routes to new structure
- Clean up old dashboard routes

Phase 6 & Testing
- Update Zustand store
- Comprehensive testing
- Bug fixes and polish

---

## Conclusion

This refactoring transforms the sidebar from a context-ambiguous navigation system into a clear, context-aware workspace switcher. By embracing the "one context at a time" principle and providing explicit workspace switching in the header, users will always know where they are and what capabilities are available to them.

The separation of personal and organizational scopes aligns with the underlying route structure (`/p/` and `/o/`), making the entire system more intuitive and scalable for future growth.